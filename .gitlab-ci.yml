# ! DO NOT set latest here USE custom hash !
image: registry.gitlab.com/satoshilabs/trezor/trezor-suite/base:faa15996fb896c7dffedda20a6ee76078aed6051

before_script:
    - yarn install --network-timeout 100000

include:
    - ci/environment.yml
    - ci/install-and-build.yml
    - ci/packages/components.yml
    # - ci/packages/components-v2.yml
    - ci/packages/components-storybook.yml
    - ci/packages/components-storybook-v2.yml
    - ci/packages/suite.yml
    - ci/packages/suite-web.yml
    - ci/packages/suite-desktop.yml
    - ci/packages/suite-native.yml
    - ci/packages/blockchain-link.yml
    - ci/packages/rollout.yml

variables:
    PACKAGE_PATH_COMPONENTS: 'packages/components-storybook'
    PACKAGE_PATH_SUITE_WEB: 'packages/suite-web'
    PACKAGE_PATH_SUITE_NATIVE: 'packages/suite-native'
    PACKAGE_PATH_SUITE_DESKTOP: 'packages/suite-desktop'
    PACKAGE_PATH_CONNECT_EXPLORER: 'packages/connect-explorer'
    DEV_SERVER_URL: 'https://suite.corp.sldev.cz'

stages:
    - 'setup environment'
    - 'lint and types'
    - 'unit testing'
    - build
    - 'deploy to dev servers'
    - 'integration testing'
    - 'build desktop apps'
    - misc

lint:
    dependencies:
        - 'install and build'
    script:
        - 'yarn lerna run lint'
    stage: 'lint and types'

type check:
    dependencies:
        - 'install and build'
    script:
        - 'yarn lerna run type-check'
    stage: 'lint and types'
