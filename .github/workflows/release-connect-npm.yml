name: "[Release] connect npm"
on:
  workflow_dispatch:
    inputs:
      package:
        description: Name of the package to deploy.
        required: true
        type: choice
        options:
          - connect
          - connect-web
          - connect-webextension
      deploymentType:
        description: "Specifies the deployment type for the npm package. (example: canary, stable)"
        required: true
        type: choice
        options:
          - canary
          - stable

jobs:
  deploy-npm-beta:
    environment: npm-packages
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: develop

      - name: Set deployment type
        id: set_deployment_type
        run: |
          if [ "${{ github.event.inputs.deploymentType }}" == "canary" ]; then
            echo "DEPLOYMENT_TYPE=beta" >> $GITHUB_ENV
          else
            echo "DEPLOYMENT_TYPE=latest" >> $GITHUB_ENV
          fi

      - name: Deploy to NPM ${{ github.event.inputs.package }}
        env:
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        uses: ./.github/actions/release-connect-npm
        with:
          deploymentType: ${{ env.DEPLOYMENT_TYPE }}
          packageName: ${{ github.event.inputs.package }}
