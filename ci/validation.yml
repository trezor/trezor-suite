code format lint:
  stage: validation
  script:
    - yarn install --frozen-lockfile --cache-folder .yarn --prefer-offline
    - yarn format:verify

lint:
  stage: validation
  script:
    - npx yarn-deduplicate --list --fail
    - yarn install --frozen-lockfile --cache-folder .yarn --prefer-offline
    - yarn build:libs
    - yarn lint

typescript:
  stage: validation
  script:
    - yarn install --frozen-lockfile --cache-folder .yarn --prefer-offline
    - yarn verify-project-references
    - yarn build:libs
    - lerna run type-check

unit tests:
  stage: validation
  script:
    - yarn install --frozen-lockfile --cache-folder .yarn --prefer-offline
    - yarn build:libs
    - lerna run --stream test:unit -- --passWithNoTests

msg-system config validation:
  stage: validation
  script:
    - yarn install --frozen-lockfile --cache-folder .yarn --prefer-offline
    - yarn workspace @trezor/suite-data msg-system-validate-config

# REF-TODO: only sketches so far, improve
# REF-TODO github https://github.com/trezor/connect/pull/1050
connect-plugins-ethereum unit tests:
  stage: validation
  only:
    refs:
      - develop
    changes:
      - packages/connect-plugins/ethereum
  script:
    - cd packages/plugins/ethereum
    - yarn
    - yarn test:unit

connect-plugins-stellar unit tests:
  stage: validation
  only:
    refs:
      - develop
    changes:
      - packages/connect-plugins/stellar
  script:
    - cd packages/plugins/stellar
    - yarn
    - yarn test:unit
